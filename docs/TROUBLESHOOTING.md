# AIOS Troubleshooting Guide

This guide provides solutions to common issues encountered while using or developing the AIOS (AI Orchestration System).

## 1. General Issues

### 1.1 Application Fails to Start

**Problem:** The AIOS application does not start, or exits immediately after starting.

**Possible Causes:**
*   Missing or incorrect environment variables (e.g., `JWT_SECRET`).
*   Port already in use.
*   Dependency issues.
*   Configuration errors.

**Solutions:**
1.  **Check Environment Variables:** Ensure all required environment variables (especially `JWT_SECRET` as seen in `security/auth.py`) are set correctly. You can verify this by running `echo $JWT_SECRET` (or the equivalent for your OS).
2.  **Check Port Availability:** Ensure the port the AIOS is trying to bind to (default 8000) is not already in use. You can check this using `lsof -i :8000` (macOS/Linux) or `netstat -ano | findstr :8000` (Windows). If the port is in use, either stop the conflicting process or configure AIOS to use a different port.
3.  **Install Dependencies:** Make sure all Python dependencies are installed. Run `pip install -r requirements.txt` (assuming a `requirements.txt` file exists).
4.  **Review Configuration:** Check `config/ai_os_config.py` and any related configuration files for syntax errors or incorrect values.
5.  **Examine Logs:** Look for error messages in the console output or application logs. These messages often provide specific details about the startup failure.

### 1.2 "Could not validate credentials" Error

**Problem:** When making API calls, you receive a 401 Unauthorized error with the message "Could not validate credentials."

**Possible Causes:**
*   Invalid or expired JWT token.
*   Missing `Authorization` header.
*   Incorrect `SECRET_KEY` for JWT signing.

**Solutions:**
1.  **Verify Token:** Ensure you are providing a valid and unexpired JWT token in the `Authorization: Bearer <token>` header of your request.
2.  **Check `SECRET_KEY`:** Confirm that the `JWT_SECRET` used by the AIOS server matches the secret used to sign your JWT token. This is defined in `config/ai_os_config.py` or as an environment variable.
3.  **Token Expiration:** If your token has expired, obtain a new one via the `/token` endpoint.

### 1.3 API Key Validation Failures

**Problem:** API keys are not being validated correctly, or access is denied.

**Possible Causes:**
*   API key is invalid, expired, or revoked.
*   Incorrect API key provided.
*   `api_keys.json` file issues.

**Solutions:**
1.  **Check API Key Status:** Use the `APIKeyManager` functions (e.g., `validate_api_key`, `get_user_api_keys`) to verify the status of the API key. Ensure it is active and not expired.
2.  **Verify Key:** Double-check that the API key you are using matches a key generated by the system.
3.  **Inspect `api_keys.json`:** If `api_keys.json` is used for storage, ensure it exists, is readable, and contains the expected API key entries. Corrupted JSON can cause issues.

## 2. Performance Issues

### 2.1 Slow API Responses

**Problem:** API endpoints are responding slowly.

**Possible Causes:**
*   High CPU/memory usage on the server.
*   Inefficient database queries or I/O operations.
*   Network latency.
*   Ineffective load balancing.

**Solutions:**
1.  **Monitor System Resources:** Use the `/system/monitor_resources` endpoint or system tools (e.g., `top`, `htop`, `Task Manager`) to check CPU, memory, and disk I/O usage. If resources are consistently high, consider scaling up or optimizing resource-intensive operations.
2.  **Optimize Database Interactions:** Review database queries for efficiency. Ensure proper indexing is in place. If using Redis, verify its performance and connectivity.
3.  **Check Load Balancing:** If multiple servers are in use, ensure the round-robin load balancing in `orchestrator_service.py`'s `execute_command` function is distributing requests evenly. Check server health via the `/health` endpoint.
4.  **Caching:** Verify that the in-memory caching for the `/health` endpoint is working as expected to reduce redundant computations.

### 2.2 Server Unreachable / Health Check Failures

**Problem:** Registered servers are reported as unhealthy or unreachable.

**Possible Causes:**
*   Server process crashed or stopped.
*   Network connectivity issues between orchestrator and server.
*   Server's `/health` endpoint is not responding correctly.

**Solutions:**
1.  **Check Server Status:** Log in to the problematic server and verify that the AIOS server process is running.
2.  **Network Connectivity:** Test network connectivity from the orchestrator to the server's health endpoint (e.g., `curl http://<server_ip>:<port>/health`). Check firewall rules.
3.  **Server Logs:** Examine the logs of the unhealthy server for any errors or exceptions that might explain why its `/health` endpoint is failing.

## 3. Development Issues

### 3.1 "Unexpected indentation" or "Expected expression" Errors

**Problem:** Python syntax errors related to indentation or missing expressions.

**Possible Causes:**
*   Incorrect spacing (mixing tabs and spaces).
*   Missing parentheses, brackets, or colons.
*   Copy-paste errors.

**Solutions:**
1.  **Use a Linter/IDE:** Configure your IDE (e.g., VS Code, PyCharm) with a Python linter (like Pylint or Flake8) to automatically highlight syntax errors and enforce consistent formatting.
2.  **Check Surrounding Lines:** Carefully examine the lines immediately before and after the reported error line for any missing or extra characters.
3.  **Consistent Indentation:** Ensure you are consistently using either spaces or tabs for indentation throughout your Python files. Most Python projects use 4 spaces.

### 3.2 Dependency Conflicts

**Problem:** `pip install` fails or the application crashes due to conflicting package versions.

**Possible Causes:**
*   Incompatible versions of libraries.
*   Corrupted virtual environment.

**Solutions:**
1.  **Use Virtual Environments:** Always use a Python virtual environment (`python -m venv .venv`) to isolate project dependencies and prevent conflicts with other projects.
2.  **Recreate Virtual Environment:** If conflicts persist, try deleting and recreating your virtual environment, then reinstalling dependencies.
3.  **Check `requirements.txt`:** Ensure `requirements.txt` specifies compatible versions of all libraries. If necessary, use `pipdeptree` to visualize the dependency tree and identify conflicts.

## 4. System Operations Issues

### 4.1 Resource Limit Configuration Errors

**Problem:** Setting resource limits via `/system/set_resource_limits` does not work as expected.

**Possible Causes:**
*   Invalid input parameters.
*   Underlying OS limitations or permissions.

**Solutions:**
1.  **Validate Input:** Ensure the JSON payload sent to `/system/set_resource_limits` contains valid numeric values for `cpu_limit` and `memory_limit`.
2.  **Check Permissions:** Verify that the AIOS application has the necessary operating system permissions to modify resource limits. This often requires running with elevated privileges or specific user group memberships.
3.  **OS Compatibility:** Confirm that the resource limiting features are supported and configured on your operating system.

### 4.2 Backup System Failures

**Problem:** The backup system is not creating backups or is failing.

**Possible Causes:**
*   Incorrect backup configuration.
*   Insufficient disk space.
*   Permissions issues for backup directory.

**Solutions:**
1.  **Review Configuration:** Check the backup configuration in `config/ai_os_config.py` for correct paths and schedules.
2.  **Disk Space:** Ensure there is enough free disk space in the backup destination.
3.  **Directory Permissions:** Verify that the AIOS application has write permissions to the configured backup directory.
4.  **Examine Backup Logs:** Check any logs generated by the backup process for specific error messages.